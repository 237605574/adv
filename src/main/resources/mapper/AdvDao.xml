<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace指定我们的到具体的bean -->
<mapper namespace="com.adv.dao.AdvDao">
    <insert id="addAdv">
        INSERT IGNORE INTO
            `adv`
            (`id`, `file_url`, `name`, `start_date`, `end_date`, `type`, `homepage`, `display_detail`)
        VALUES
            (#{advObj.id}, #{advObj.fileUrl}, #{advObj.name}, #{advObj.startDate}, #{advObj.endDate}, #{advObj.type},
             #{advObj.homepage},
             #{advObj.displayDetail})
    </insert>
    <select id="checkNameCount" resultType="Integer">
        SELECT count(*)
        FROM
            `adv`
        WHERE
            `name` = #{advObj.name}
    </select>
    <!--resultMap填type-->
    <select id="getAdvListByUser" resultMap="AdvObj">
        SELECT adv.*
        FROM
            `adv`, `user_adv`
        WHERE
            adv.id = user_adv.adv_id AND user_adv.user_id = #{user.id} AND adv.is_valid = 1;

    </select>
    <!--使用ResultMap来进行返回list<AdvObj> 类型的查询-->
    <resultMap id="AdvObj" type="com.adv.pojo.AdvObj">
        <!--
        字标签属性:id 表示属性
        column：数据库查询的列的字段，property：自定义数据类型的变量的名字
        -->
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="type" property="type"/>
        <result column="file_url" property="fileUrl"/>
        <result column="start_date" property="startDate"/>
        <result column="end_date" property="endDate"/>
        <result column="is_valid" property="isValid"/>
        <result column="homepage" property="homepage"/>
        <result column="display_detail" property="display_detail"/>
    </resultMap>
    <select id="getAdv" resultType="com.adv.pojo.AdvObj">
        SELECT *
        FROM
            `adv`
        WHERE adv.id = #{advId}
    </select>
    <delete id="deleteAdv">
        DELETE FROM `adv`
        WHERE adv.id = #{advId}
    </delete>
    <update id="updateState">
        UPDATE
            `adv`
        SET
            `is_valid` = 0
        WHERE
            NOW() > `end_date` AND `is_valid` = 1
    </update>
    <update id="updateAdv">
        REPLACE INTO
            `adv`
            (`id`, `file_url`, `name`, `start_date`, `end_date`, `type`, `homepage`, `display_detail`)
        VALUES
            (#{advObj.id}, #{advObj.fileUrl}, #{advObj.name}, #{advObj.startDate}, #{advObj.endDate}, #{advObj.type},
             #{advObj.homepage},
             #{advObj.displayDetail})
    </update>
</mapper>